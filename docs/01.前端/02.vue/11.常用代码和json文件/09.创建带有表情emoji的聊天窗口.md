---
title: åˆ›å»ºå¸¦æœ‰è¡¨æƒ…emojiçš„èŠå¤©çª—å£
date: 2021-04-10 14:49:09
permalink: /pages/a67ad8/
categories:
  - å‰ç«¯
  - vue
  - å¸¸ç”¨ä»£ç å’Œjsonæ–‡ä»¶
tags:
  - 
---
## ä¸€.copyç‰ˆæœ¬

```html
<template>
    <div class="area-box">
        <div ref="area"  contenteditable="true" style="height: 100px;width: 100px;overflow: auto;"></div>
        <div class="send-box">
            <i @click="emoji_show = !emoji_show" style="width: 40px;height: 40px;background-color: red;z-index:10;">aaa</i>
            <div v-show="emoji_show" class="emotion-box">
                <div class="emotion-list">
                    <i v-for="v in emoji" @click="addEmoji(v)">{{v}}</i>
                </div>
            </div>
        </div>
    </div>
</template>
<!-- 				<svg class="icon" aria-hidden="true">
				  <use xlink:href="#"></use>
				</svg> -->
<script>
	// è¡¨æƒ…emojiä¹Ÿæ˜¯å­—ç¬¦é€šè¿‡jsè½¬åŒ–è€Œæ¥ï¼Œå¯ä»¥ä½¿utf8mb4çš„å­—ç¬¦ä¾‹å¦‚\u1F606,å¯ä»¥å­˜å‚¨äºæ•°æ®åº“ï¼ˆä¼šè‡ªåŠ¨ç¼–ç ä¸ºè¡¨æƒ…æ ·å¼ï¼‰
	export default {
 data() {
            return {
                emoji_show: false,
                emoji: ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚"],
            }
        },
        methods: {
            addEmoji(str) {
                let area = this.$refs.area;
              // ç”±äºtextareaä¸èƒ½è‡ªé€‚åº”ï¼Œæ‰€ä»¥æ”¹ç”¨divé€šè¿‡contenteditableå±æ€§æ¥ä½œä¸ºtextarea
              // ifå’Œelse ifçš„æ¡ä»¶æ˜¯åˆ¤æ–­å½“textareaæ²¡æœ‰æ•°æ®ä¸”æ²¡æœ‰ç„¦ç‚¹çš„æ—¶å€™æ·»åŠ è¡¨æƒ…ï¼ˆä¼šå‡ºé”™ï¼‰ï¼Œè¿›è¡Œä¸€å®šçš„å¤„ç†å…·ä½“æ€æ ·å¤„ç†æˆ‘ä¸çŸ¥é“ï¼Œä½†ä¸»è¦æ˜¯å› ä¸ºç¼ºå°‘Range()ç±»ï¼ŒsetStart(nodeç±», numå®šä½)æ–¹æ³•æ˜¯åº•å±‚è°ƒç”¨childNodes[0],è¿™é‡Œæ—¢æ˜¯textareaçš„æ–‡æœ¬èŠ‚ç‚¹
                if (document.selection) {
									console.log('docu')
                    area.focus();
                    const sel = document.selection.createRange();
                    sel.text = str;
                    sel.select();
                } else if (area.selectionStart || area.selectionStart === '0') {// Mozilla/NETSCAPE support
                    console.log('null')
										const startPos = area.selectionStart,
                        endPos = area.selectionEnd,
                        // save scrollTop before insert
                        restoreTop = area.scrollTop;
                    area.innerText = area.innerText.substring(0, startPos) + str + area.innerText.substring(endPos, area.innerText.length);
                    if (restoreTop > 0) {
                        // restore previous scrollTop
                        area.scrollTop = restoreTop;
                    }
                    area.focus();
                    area.selectionStart = startPos + str.length;
                    area.selectionEnd = startPos + str.length;
                } else {
									console.log('window')
                    const selection = window.getSelection();

                    // .nodeName === '#text'
                    if (selection.anchorNode && selection.anchorNode.nodeType === 3 && selection.anchorNode.parentNode === area) {// å…‰æ ‡é€‰ä¸­
                        const range = selection.getRangeAt(0),
                            rangeStartOffset = range.startOffset,// è·å–å…‰æ ‡ä½ç½®
                            textNode = range.startContainer;

                        if (!range.collapsed) {// ä¸æ˜¯åŒä¸€ä½ç½® ä»£è¡¨é€‰æ‹©äº†å†…å®¹ åˆ™å…ˆåˆ é™¤é€‰æ‹©çš„å†…å®¹
                            range.deleteContents();
                        }

                        textNode.insertData(rangeStartOffset, str);// æ–‡æœ¬èŠ‚ç‚¹åœ¨å…‰æ ‡ä½ç½®å¤„æ’å…¥æ–°çš„è¡¨æƒ…å†…å®¹
                        range.setStart(selection.anchorNode, rangeStartOffset + str.length);// å…‰æ ‡ç§»åŠ¨åˆ°è¡¨æƒ…çš„åé¢, 1ä¸ªemojiçš„é•¿åº¦å¹¶ä¸å›ºå®š
                        range.collapse(true);// å…‰æ ‡å¼€å§‹å’Œå…‰æ ‡ç»“æŸé‡å 
                        selection.removeAllRanges();// æ¸…é™¤é€‰å®šå¯¹è±¡çš„æ‰€æœ‰å…‰æ ‡å¯¹è±¡
                        selection.addRange(range);// æ’å…¥æ–°çš„å…‰æ ‡å¯¹è±¡
                    } else {// æœªå‡ºç°å…‰æ ‡ ç›´æ¥ç‚¹å‡»è¡¨æƒ… é»˜è®¤æ’å…¥æœ€åä½ç½®
                        area.innerText += str;
                        selection.selectAllChildren(area);// é€‰æ‹©ç¼–è¾‘å™¨
                        selection.collapseToEnd();// å…‰æ ‡ç§»åŠ¨è‡³æœ€å
                    }
                }
            },
        },
		mounted() {
			let _self = this
			uni.request({
				url: _self.mainUrl + 'dy/getbiaoqing/',
				success(r) {
					console.log(r)
					_self.li = r.data
					console.log(_self.li)
				}
			})
		}
	}
</script>

<style>
	.area-box{
		background-color: white;
		height: 500px;
		width: 300px;
	}
	.send-box{
		background-color: #0077AA;
		height: 300px;
		width: 300px;
	}
	.emotion-list{
		height: 200px;
		width: 300px;
		background-color: #0086B3;
	}
	.emotion-list i{
		height: 30px;
		width: 30px;
	}

	li{
		float: left;
	}
	li{
			padding-left: 10px;
	}

#textarea{
	height: 100px;
	width: 100px;
	overflow: hidden;
}

</style>
```





## äºŒ.ç®€æ´ç‰ˆ

```html
<template>
	<div style="height: 500px;width: 100vw;background-color: white;">

		<div contenteditable="true" class="area"  ref="area"></div>
	
		<li v-for="i in emoji" @click="input_(i)">{{i}}</li>
	</div>
</template>

<script>
	export default{
		data(){
			return{
				 emoji: ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚"],
			}
		},

		methods:{
			input_(i){
				let area = this.$refs.area;

					let selection = window.getSelection()
					 if (selection.anchorNode && selection.anchorNode.nodeType === 3 && selection.anchorNode.parentNode === area){
						 let c = selection.getRangeAt(0)
						 let node = c.startContainer
						 node.insertData(c.startOffset, i)
						 c.setStart(node, c.startOffset+i.length)
						 c.collapse(true)
						 selection.removeAllRanges()
						 selection.addRange(c)
					 }else{
						 let newrange = document.createRange()
						 newrange.setStart(area, 0)
						 let node = newrange.startContainer
						 node.innerHTML += i
						 newrange.setStart(node.childNodes[0], i.length)
						 newrange.collapse(true)
						 selection.removeAllRanges()
						 selection.addRange(newrange)
					 }
			}
		
		}
	}
</script>

<style>
.area{
	height: 200px;
	width: 200px;
}
</style>

```



## ä¸‰.inputç‰ˆæœ¬

###### æ³¨ï¼šuni-appçš„inputå¹¶ä¸æ˜¯åŸæ¥çš„inputï¼Œä¸å­˜åœ¨setSelectionRange(start,end)æ–¹æ³•

```javascript
export default {
handleFaceChoose (face) {
    const value = this.shareText 	// data(){shareText: ""}
    const el = this.$refs.shareTextArea		// <input ref="shareTextArea"  />
    const startPos = el.selectionStart // è·å–å…‰æ ‡çš„å¼€å§‹ä½ç½®
    const endPos = el.selectionEnd // è·å–å…‰æ ‡çš„ç»“æŸä½ç½®
    const newValue = // æ‹¼æ¥
        value.substring(0, startPos) +
        face +
        value.substring(endPos, value.length)
    this.shareText = newValue
    // é‡ç½®å…‰æ ‡ä½ç½®ç´§è·Ÿåœ¨è¡¨æƒ…æ–‡æœ¬åé¢
    if (el.setSelectionRange) {
        setTimeout(() => {
            const index = startPos + face.length
            el.setSelectionRange(index, index)
        }, 0)
    }
},
}
```

